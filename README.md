# AI Character Bot ‚Üí Image ‚Üí DeviantArt (Local, –±–µ–∑ Docker)

–ö–∞—Ä–∫–∞—Å –±–æ—Ç–∞ –Ω–∞ **aiogram 3** + –º–∏–Ω–∏-—Å–µ—Ä–≤–µ—Ä **FastAPI** –¥–ª—è OAuth DeviantArt.
–†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (long polling –¥–ª—è Telegram –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

## 1) –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+
- –û—Ç–∫—Ä—ã—Ç—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–¥–æ—Å—Ç—É–ø –∫ API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø—É–±–ª–∏—á–Ω—ã–π HTTPS-–¥–æ–º–µ–Ω/—Ç—É–Ω–Ω–µ–ª—å (ngrok, Cloudflare Tunnel) –¥–ª—è DeviantArt OAuth callback

## 2) –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤
python -m venv .venv
# Windows: .venv\Scripts\activate
source .venv/bin/activate
pip install -r requirements.txt
```

## 3) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` ‚Üí `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:
- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞
- `FERNET_KEY` ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ:
  ```bash
  python - <<'PY'
from cryptography.fernet import Fernet
print(Fernet.generate_key().decode())
PY
  ```
- `DA_CLIENT_ID`, `DA_CLIENT_SECRET` ‚Äî –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞ DeviantArt
- `DA_REDIRECT_URI` ‚Äî URL `https://<–≤–∞—à-—Ö–æ—Å—Ç>/oauth/deviantart/callback`.
  –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –º–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å (ngrok/CF Tunnel) –∫ –ø–æ—Ä—Ç—É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é :8080).
- `OPENAI_API_KEY` ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é (–∏–Ω–∞—á–µ –≤–∫–ª—é—á–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤)
- `TENSORART_*` –∏–ª–∏ `REPLICATE_*` ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é

> –ï—Å–ª–∏ –Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ DeviantArt –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å ‚Äî –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞.

## 4) –ó–∞–ø—É—Å–∫
–û—Ç–∫—Ä–æ–π—Ç–µ **–¥–≤–µ** –∫–æ–Ω—Å–æ–ª–∏ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –Ω–∏–∂–µ):

### –í–∫–ª–∞–¥–∫–∞ A ‚Äî FastAPI (OAuth callback)
```bash
source .venv/bin/activate          # Windows: .venv\Scripts\activate
uvicorn app.web.main:app --host 0.0.0.0 --port 8080
```

### –í–∫–ª–∞–¥–∫–∞ B ‚Äî Telegram-–±–æ—Ç (long polling)
```bash
source .venv/bin/activate          # Windows: .venv\Scripts\activate
python -m app.bot
```

> –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–≤–µ–±—Ö—É–∫**, –ø—Ä–æ–ø–∏—à–∏—Ç–µ `WEBHOOK_URL` –≤ `.env`, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç 8080 –Ω–∞—Ä—É–∂—É –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ **–±–æ—Ç** –≤ —Ä–µ–∂–∏–º–µ webhook (–±–æ—Ç —Å–∞–º –ø–æ—Å—Ç–∞–≤–∏—Ç webhook –Ω–∞ —Å—Ç–∞—Ä—Ç–µ).

## 5) –ë—ã—Å—Ç—Ä—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
1. –í Telegram: `/start` ‚Üí –∫–Ω–æ–ø–∫–∞ **¬´üß¨ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞¬ª** ‚Üí –≤—ã–±—Ä–∞—Ç—å —Å—Ç–∏–ª—å.
2. –ë–æ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç: –∏–¥–µ—é, –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–≥–∏, SD-–ø—Ä–æ–º–ø—Ç (—Å –Ω–µ–≥–∞—Ç–∏–≤–æ–º), –ø–æ–∫–∞–∂–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å/—Ç–æ–∫–µ–Ω—ã (–µ—Å–ª–∏ OpenAI).
3. –ù–∞–∂–º–∏—Ç–µ **¬´üñº –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ¬ª** (–Ω—É–∂–µ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π):
   - `/add_tensorart` –∏ –ø—Ä–∏—à–ª–∏—Ç–µ —Å–≤–æ–π API –∫–ª—é—á (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–æ), –∏–ª–∏
   - –¥–æ–±–∞–≤—å—Ç–µ Replicate —Ç–æ–∫–µ–Ω (—Å–º. –∫–æ–¥; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
4. –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ DeviantArt:
   - `/connect_deviantart` ‚Üí –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ (—á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ–º–µ–Ω) ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–æ—Å—Ç—É–ø ‚Üí –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞.
   - –ù–∞–∂–º–∏—Ç–µ **¬´üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ DeviantArt¬ª**.
5. –ò—Å—Ç–æ—Ä–∏—é –∏ —Å—Ç–∞—Ç—É—Å—ã —Å–º. –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö; –±–∞–∑–∞ ‚Äî `SQLite` (—Ñ–∞–π–ª `data.db`).

## 6) –°–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞
- **Linux/macOS**:
  - `scripts/start_web.sh` ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ—Ç FastAPI –Ω–∞ :8080
  - `scripts/start_bot.sh` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ (long polling)
  - `scripts/start_all.sh` ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ —Ñ–æ–Ω–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `&`)
- **Windows (PowerShell)**:
  - `scripts/start_web.ps1`
  - `scripts/start_bot.ps1`
  - `scripts/start_all.ps1` ‚Äî —Å—Ç–∞—Ä—Ç—É–µ—Ç –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

## 7) –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–í —á–∞—Ç–µ —Å –±–æ—Ç–æ–º:
- `/add_openai` ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `sk-...`
- `/add_tensorart` ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `ta_...` –∏–ª–∏ `sk_...` –Ω—É–∂–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- `/connect_deviantart` ‚Üí –ø—Ä–æ–π–¥–∏—Ç–µ OAuth –ø–æ —Å—Å—ã–ª–∫–µ
–¢–æ–∫–µ–Ω—ã –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —à–∏—Ñ—Ä—É—é—Ç—Å—è **Fernet** –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î.

## 8) –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–ò–∑–º–µ–Ω–∏–ª–∏ `.env`? –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã. –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `data.db` (SQLite).

## 9) –ü–æ–ª–µ–∑–Ω–æ –∑–Ω–∞—Ç—å
- –ï—Å–ª–∏ `WEBHOOK_URL` –ø—É—Å—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **long polling** (–ø—Ä–æ—â–µ –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö).
- –í –ø—Ä–æ–¥–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—Å—è: Postgres/Redis –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (pm2/systemd/NSSM), –Ω–æ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
- API-—Å—Ö–µ–º—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –º–µ–Ω—è—é—Ç—Å—è: –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å—Ä–∞–≤–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `app/services/*` —Å –∏—Ö –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π.

–£–¥–∞—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏! ‚ú®
